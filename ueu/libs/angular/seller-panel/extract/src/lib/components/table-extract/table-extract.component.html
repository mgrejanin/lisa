<div class="c-table-extract">
    <div class="c-table-extract__current-balance">
        <ng-container *ngIf="isLoadingWallet">
            <div class="c-resume-balance-available__loading">
                <seller-panel-loading-spinner
                    [size]="20"
                    [stroke]="2"
                    text="Carregando..."
                    textAlign="left"
                ></seller-panel-loading-spinner>
            </div>
        </ng-container>
        <ng-container *ngIf="!isLoadingWallet && !walletError">
            <span>
                Saldo dispon√≠vel: <strong>{{ currentBalance | currency: 'BRL' }}</strong>
            </span>
            <ng-container *ngIf="blockedBalance">
                <span class="c-table-extract__blocked-balance">
                    Saldo bloqueado:
                    <strong (click)="onShowblockedBalanceModal()">{{ blockedBalance | currency: 'BRL' }}</strong>
                </span>
            </ng-container>
        </ng-container>
        <ng-container *ngIf="walletError">
            <div class="c-table-extract__wallet-error">Erro ao verificar seu saldo...</div>
        </ng-container>
    </div>
    <div class="c-table-extract--item" *ngFor="let cell of data?.extract">
        <header class="c-table-extract__header">
            <div class="c-table-extract__header--day">
                <p>
                    {{ isTodayExtractDate(cell?.header?.date) ? 'Hoje' : (cell?.header?.date | date: 'dd/MM/yyyy') }}
                </p>
            </div>
            <div class="c-table-extract__header--balance">{{ cell?.header?.balance | currency: 'BRL' }}</div>
        </header>
        <div class="c-table-extract__table-container">
            <table mat-table [dataSource]="cell?.itens">
                <!-- Icon type Column -->
                <ng-container matColumnDef="icon">
                    <th mat-header-cell *matHeaderCellDef>Icon</th>
                    <td
                        mat-cell
                        [ngClass]="{ 'mat-column-icon--no-line': cell?.itens?.length === 1 }"
                        *matCellDef="let element"
                    >
                        <mat-icon [svgIcon]="icons[element.type_item + '_' + element.type_transaction]"></mat-icon>
                    </td>
                </ng-container>

                <!-- Title Column -->
                <ng-container matColumnDef="title">
                    <th mat-header-cell *matHeaderCellDef>Tipo</th>
                    <td mat-cell (click)="onReceivableDetails()" *matCellDef="let element">{{ element.title }}</td>
                </ng-container>

                <!-- Description Column -->
                <ng-container matColumnDef="description">
                    <th mat-header-cell *matHeaderCellDef>Description</th>
                    <td mat-cell *matCellDef="let element">
                        {{ shortDescription(element.description).toLowerCase() }}
                    </td>
                </ng-container>

                <!-- Status Column -->
                <ng-container matColumnDef="status">
                    <th mat-header-cell *matHeaderCellDef>Staus</th>
                    <td mat-cell *matCellDef="let element">
                        <span
                            class="mat-column-status--default"
                            [ngClass]="{
                                'mat-column-status--cancelled': element.status === 'cancelled',
                                'mat-column-status--processing': element.status === 'processing'
                            }"
                        >
                            {{
                                element.status !== 'finished' && element.status !== 'approved'
                                    ? status[element.status]
                                    : ''
                            }}
                        </span>
                    </td>
                </ng-container>

                <!-- Value Column -->
                <ng-container matColumnDef="value">
                    <th mat-header-cell *matHeaderCellDef>Valor</th>
                    <td
                        mat-cell
                        *matCellDef="let element"
                        [ngClass]="{ 'mat-column-value--processing': element.status === 'processing' }"
                    >
                        {{ element.value | currency: 'BRL' }}

                        <mat-icon class="mat-column-value__options" *ngIf="element.fee > 0 || element?.receipt">
                            chevron_right
                        </mat-icon>
                    </td>
                </ng-container>

                <tr class="test-tr" mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                <tr
                    class="test-tr"
                    mat-row
                    (click)="openExtractDetails(row)"
                    *matRowDef="let row; columns: displayedColumns"
                ></tr>
            </table>
        </div>
    </div>
</div>

<seller-panel-sidenav-details>
    <seller-panel-extract-details [data]="currentReceipt"></seller-panel-extract-details>
</seller-panel-sidenav-details>
