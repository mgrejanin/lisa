<seller-panel-header (logout)="onLogout()"></seller-panel-header>
<ng-container *ngIf="isLoading; else credentialsContent">
    <div class="c-credential-page__loading">
        <seller-panel-loading-spinner [size]="50" [stroke]="5"></seller-panel-loading-spinner>
    </div>
</ng-container>
<ng-template #credentialsContent>
    <div class="c-credential-page o-page">
        <div class="c-credential-page__header">
            <div class="c-credential-page__header--title">
                <apollo-heading>Configurar integrações (token de acesso)</apollo-heading>
            </div>
            <apollo-text class="c-credential-page__header--description">
                Para garantir integridade e segurança das informações durante a comunicação entre o seu site e o PicPay,
                é necessário a utilização de credenciais.<br />Para sua segurança, sempre esconda os dados ao
                compartilhar a tela.
            </apollo-text>
        </div>
        <ng-container *ngTemplateOutlet="page"></ng-container>
    </div>
</ng-template>

<ng-template #page>
    <ng-container [ngSwitch]="haveCredential">
        <ng-container *ngSwitchCase="'initial'">
            <div class="c-new-credential-page">
                <div class="c-new-credential-page__content">
                    <img
                        src="./assets/images/avatar-create.svg"
                        alt="Crie sua Credencial"
                        class="c-new-credential-page__content--icon"
                    />
                    <apollo-heading class="c-new-credential-page__content--title"
                        >Crie sua credencial para integrar a API</apollo-heading
                    >
                    <apollo-text class="c-new-credential-page__content--description">
                        As credenciais são as <span>chaves</span> que habilitam a utilização de nossas APIs, para o
                        serviço de Remessa de Créditos você deve gerar novas credenciais para cada remessa que for
                        lançar.
                    </apollo-text>
                    <apollo-button
                        class="c-shipment__actions__next"
                        size="md"
                        type="button"
                        routerLink="gerar-credencial"
                        routerLinkActive="router-link-active"
                    >
                        Nova Credencial
                    </apollo-button>
                </div>
            </div>
        </ng-container>
        <ng-container *ngSwitchCase="'config'">
            <div class="c-config-credential-page">
                <div class="c-config-credential-page__content">
                    <div class="c-config-credential-page__content--header">
                        <apollo-text
                            fontSize="2xl"
                            fontWeight="bold"
                            class="c-config-credential-page__content--header-title"
                            >Suas credenciais da API:</apollo-text
                        >
                        <apollo-button
                            class="c-config-credential-page__content--header-toggle"
                            variant="link"
                            (click)="hiddenData = !hiddenData"
                        >
                            <apollo-icon
                                slot="leading-icon"
                                [svgIcon]="hiddenData ? 'interface-eye-slash' : 'interface-eye'"
                                size="sm"
                            ></apollo-icon>
                            {{ hiddenData ? 'Mostrar dados' : 'Esconder dados' }}
                        </apollo-button>
                    </div>
                    <div class="c-config-credential-page__content--apis">
                        <apollo-text fontWeight="bold" class="c-config-credential-page__content--apis-title">
                            <span *ngIf="isLoading; then loadingName; else projectNameTemplate"></span>
                            <ng-template #loadingName>
                                <apollo-template-skeleton height="40px"></apollo-template-skeleton>
                            </ng-template>
                            <ng-template #projectNameTemplate> {{ projectName }} </ng-template>
                        </apollo-text>
                        <span *ngIf="disableCredential; then enableCredentials; else disableCredentials"></span>
                        <ng-template #disableCredentials>
                            <apollo-button variant="link" (click)="openDisableCredential()"
                                >Desativar credencial</apollo-button
                            >
                        </ng-template>
                        <ng-template #enableCredentials>
                            <apollo-button variant="link" (click)="enableCredential()"
                                >Reativar credencial</apollo-button
                            >
                        </ng-template>
                    </div>
                    <div class="c-config-credential-page__content--fields">
                        <div *ngIf="!(clientId && clientSecret); else infoCredential">
                            <apollo-template-skeleton height="40px" count="2"></apollo-template-skeleton>
                        </div>
                        <ng-template #infoCredential>
                            <apollo-textfield
                                label="Client ID"
                                class="c-config-credential__content--field"
                                name="client-id"
                                [type]="hiddenData ? 'password' : 'text'"
                                [value]="clientId"
                                [disabled]="disableCredential"
                                [trailingIcon]="true"
                                readonly
                            >
                                <apollo-textfield-icon
                                    *ngIf="!disableCredential"
                                    slot="trailing-icon"
                                    class="copy-paste"
                                    (click)="copyToClipboard(clientId)"
                                >
                                    <apollo-icon svg-icon="interface-copy"></apollo-icon>
                                </apollo-textfield-icon>
                            </apollo-textfield>
                            <apollo-textfield
                                label="Client Secret"
                                name="client-secret"
                                [type]="hiddenData ? 'password' : 'text'"
                                class="c-config-credential__content--field"
                                [value]="clientSecret"
                                [disabled]="disableCredential"
                                [trailingIcon]="true"
                                readonly
                            >
                                <apollo-textfield-icon
                                    *ngIf="!disableCredential"
                                    slot="trailing-icon"
                                    class="copy-paste"
                                    (click)="copyToClipboard(clientSecret)"
                                >
                                    <apollo-icon svg-icon="interface-copy"></apollo-icon>
                                </apollo-textfield-icon>
                            </apollo-textfield>
                        </ng-template>
                    </div>
                    <div class="c-config-credential-page__content--new-credential" *ngIf="!disableCredential">
                        <apollo-button variant="link" (click)="openUpdateSecret()"
                            >Gerar novo Client Secret</apollo-button
                        >
                    </div>
                </div>
                <div class="c-config-credential-page__more-info">
                    <apollo-text class="c-config-credential-page__more-info--text">
                        Para mais informações:
                        <apollo-button variant="link" href="https://studio.picpay.com/docs/b2p">
                            Veja a documentação da API
                        </apollo-button>
                    </apollo-text>
                    <apollo-text class="c-config-credential-page__more-info--text">
                        Ficou com dúvidas?
                        <apollo-button
                            variant="link"
                            href="https://ajudaempresas.picpay.com/hc/pt-br/articles/360054733531-Tudo-sobre-Remessa-de-Cr%C3%A9dito"
                            target="_blank"
                        >
                            Entenda o que é integração
                        </apollo-button>
                    </apollo-text>
                </div>
            </div>
        </ng-container>
        <ng-container *ngSwitchCase="'error'">
            <apollo-feedback-page
                page-title="Algum problema aconteceu..."
                page-subtitle="Sua credencial não pode ser carregada, por favor, aguarde alguns minutos e tente novamente"
                type="error"
                use-figure="false"
            >
                <apollo-feedback-page-actions>
                    <apollo-button variant="unelevated" routerLink="/" routerLinkActive="true"
                        >Voltar para inicial</apollo-button
                    >
                </apollo-feedback-page-actions>
            </apollo-feedback-page>
        </ng-container>
    </ng-container>
</ng-template>

<apollo-dialog
    #disableCredentialsDialog
    icon="feedback-danger"
    confirm-button-label="Desativar credencial"
    dialog-title="Deseja desativar a credencial?"
    (cancelButtonClick)="onCancel()"
    (confirmButtonClick)="onDisableSubmit()"
>
    <apollo-text>
        Antes de desativar a credencial, certifique-se que ela não está sendo utilizado em nenhuma campanha ativa. Se
        quiser, você pode reativar a credencial.
    </apollo-text>
</apollo-dialog>

<apollo-dialog
    #updateSecretDialog
    icon="feedback-danger"
    confirm-button-label="Gerar Client_Secret"
    dialog-title="Deseja criar novo Client_Secret?"
    (cancelButtonClick)="onCancel()"
    (confirmButtonClick)="onUpdateSubmit()"
>
    <apollo-text>
        Ao gerar uma nova senha, você suspenderá todos os pagamentos ativos e vai precisar realizar novamente a
        integração para que ela volte a funcionar.
    </apollo-text>
</apollo-dialog>
